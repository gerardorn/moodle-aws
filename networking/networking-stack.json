{
  "AWSTemplateFormatVersion":"2010-09-09",
  "Description":"Kavak Moodle Networking Stack",
  "Parameters":{
    "IpRange":{
      "Type":"String",
      "Description":"The CIDR IP Range for this VPC. Default 10.0.0.0/24",
      "Default":"10.0.0.0/24"
    }
  },
  "Resources":{
    "Vpc":{
      "Type":"AWS::EC2::VPC",
      "Properties":{
        "CidrBlock":{
          "Ref":"IpRange"
        },
        "EnableDnsSupport":true,
        "EnableDnsHostnames":true,
        "Tags":[
          {
            "Key":"Name",
            "Value":{
              "Fn::Join":[
                "-",
                [
                  {
                    "Ref":"AWS::StackName"
                  },
                  "vpc"
                ]
              ]
            }
          }
        ]
      }
    },
    "FirstPrivateSubnet":{
      "Type":"AWS::EC2::Subnet",
      "Properties":{
        "VpcId":{
          "Ref":"Vpc"
        },
        "CidrBlock":{
          "Fn::Select":[
            0,
            {
              "Fn::Cidr":[
                {
                  "Ref":"IpRange"
                },
                4,
                6
              ]
            }
          ]
        },
        "AvailabilityZone":{
          "Fn::Select":[
            0,
            {
              "Fn::GetAZs":{
                "Ref":"AWS::Region"
              }
            }
          ]
        },
        "MapPublicIpOnLaunch":"false",
        "Tags":[
          {
            "Key":"Name",
            "Value":{
              "Fn::Join":[
                "-",
                [
                  {
                    "Ref":"AWS::StackName"
                  },
                  "first-private-subnet"
                ]
              ]
            }
          }
        ]
      }
    },
    "SecondPrivateSubnet":{
      "Type":"AWS::EC2::Subnet",
      "Properties":{
        "VpcId":{
          "Ref":"Vpc"
        },
        "CidrBlock":{
          "Fn::Select":[
            1,
            {
              "Fn::Cidr":[
                {
                  "Ref":"IpRange"
                },
                4,
                6
              ]
            }
          ]
        },
        "AvailabilityZone":{
          "Fn::Select":[
            1,
            {
              "Fn::GetAZs":{
                "Ref":"AWS::Region"
              }
            }
          ]
        },
        "MapPublicIpOnLaunch":"false",
        "Tags":[
          {
            "Key":"Name",
            "Value":{
              "Fn::Join":[
                "-",
                [
                  {
                    "Ref":"AWS::StackName"
                  },
                  "second-private-subnet"
                ]
              ]
            }
          }
        ]
      }
    },
    "DbSubnetGroup":{
      "Type":"AWS::RDS::DBSubnetGroup",
      "Properties":{
        "DBSubnetGroupDescription":"RDS Subnet Group",
        "SubnetIds":[
          {
            "Ref":"FirstPrivateSubnet"
          },
          {
            "Ref":"SecondPrivateSubnet"
          }
        ]
      }
    }
  },
  "Outputs":{
    "VpcId":{
      "Description":"The Id for the VPC created",
      "Value":{
        "Ref":"Vpc"
      }
    },
    "DbSubnetGroupName":{
      "Description":"The subnet group name for the db",
      "Value":{
        "Ref":"DbSubnetGroup"
      }
    }
  }
}
